---
layout: post
title: "Install PHP 5.3.5 with FPM (FastCGI Process Manager) support on
Apache2/Centos 5.5"
date: 2011-01-21
type: posts
---

<div class='post'>
<p>$&gt; yum upgrade<br />$&gt; yum groupinstall "Development Tools"<br />$&gt; wget <a href="http://us2.php.net/get/php-5.3.5.tar.bz2/from/us.php.net/mirror">http://us2.php.net/get/php-5.3.5.tar.bz2/from/us.php.net/mirror</a><br />$&gt; tar xvf php-5.3.5.tar.bz2<br />$&gt; yum install mysql-server httpd-devel-* libxml2-devel-* openssl-devel* xmlsec1-openssl-devel-* libpng* libjpeg* curl-devel libmcrypt* mysql-devel* mysql.* libevent libevent-devel libtool-ltdl-devel libtool apr-devel apr<br />$&gt; cd php-5.3.5<br />$&gt; ./configure --with-mysql=shared --with-openssl --enable-pdo --with-pdo-mysql=shared --with-mhash=shared --enable-soap=shared --with-config-file-path=/etc/ --with-mysqli --enable-zip --enable-shared --with-curl --enable-mbstring=all --enable-maintainer-zts --with-jpeg-dir=/usr/lib/ --with-libdir=lib64 --enable-soap --with-pdo-mysql --with-gd --with-mcrypt --enable-fpm --with-config-file-scan-dir=/etc/php.d<br />$&gt; make; make install;<br />$&gt; chmod 705 /var/log/httpd<p />Edit your php.ini to point to your new PHP's extension directory (printed as part of make install above):<br /><code>extension_dir = "/usr/local/lib/php/extensions/no-debug-zts-20090626/"</code><p />Make certain your /etc/php.d directory is only loading extensions that have been built against your new php. I only load mysql and apc<p />Now you need to tell Apache to use php-fpm via mod_fastcgi.<br /># wget <a href="http://www.fastcgi.com/dist/mod_fastcgi-current.tar.gz">http://www.fastcgi.com/dist/mod_fastcgi-current.tar.gz</a><br /># tar -zxvf mod_fastcgi-current.tar.gz<br /># cd mod_fastcgi-2.4.6/<br /># cp Makefile.AP2 Makefile<p />Compile and install mod_fastcgi for 32 bit system, enter:<br /># make top_dir=/usr/lib/httpd<br /># make install top_dir=/usr/lib/httpd<p />Compile and install mod_fastcgi for 64 bit system, enter:<br /># make top_dir=/usr/lib64/httpd<br /># make install top_dir=/usr/lib64/httpd<p />Sample output:<br /><code>make install top_dir=/usr/lib64/httpdmake[1]: Entering directory `/tmp/mod_fastcgi-2.4.6'/usr/lib64/apr-1/build/libtool --silent --mode=install cp mod_fastcgi.la /usr/lib64/httpd/modules/make[1]: Leaving directory `/tmp/mod_fastcgi-2.4.6'</code><p />Edit your Apache config to configure mod_fastcgi:<br /><code># mods-enabled/fastcgi.conf&lt;IfModule mod_fastcgi.c&gt;FastCGIExternalServer /usr/local/sbin/php-fpm -socket /tmp/php-fpm.sockAddHandler php-fastcgi .phpAction php-fastcgi /usr/local/sbin/php-fpm.fcgiScriptAlias /usr/local/sbin/php-fpm.fcgi /usr/local/sbin/php-fpm&lt;Directory /usr/local/sbin&gt;Options ExecCGI FollowSymLinksSetHandler fastcgi-scriptOrder allow,denyAllow from all&lt;/Directory&gt;&lt;/IfModule&gt;</code><p />Now edit your /usr/local/etc/php-fpm config file using settings like these:<br /><code>[www]# socketlisten = /tmp/php-fpm.socklisten.owner = apachelisten.group = apachelisten.mode = 0666# user ID/GIDuser = apachegroup = apache</code><p />Finally, <a href="http://us2.php.net/manual/en/install.fpm.php">configure an autostart script for your php-fpm daemon using these instructions</a>.</p></div>
